<!DOCTYPE html>
<html>
<head>
  <title>Asistencia</title>
</head>
<body>

<h2>Registrar asistencia</h2>

<input type="date" id="fecha">
<button id="guardar">Guardar asistencia</button>

<div id="alumnos"></div>

<script type="module">
import { db } from "./firebase.js";
import {
  collection, getDocs, addDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const contenedor = document.getElementById("alumnos");

async function cargar() {
  const data = await getDocs(collection(db, "alumnos"));
  data.forEach(doc => {
    contenedor.innerHTML += `
      <div>
        ${doc.data().nombre}
        <input type="checkbox" data-id="${doc.id}">
      </div>
    `;
  });
}

document.getElementById("guardar").onclick = async () => {
  const fecha = document.getElementById("fecha").value;
  const checks = document.querySelectorAll("input[type=checkbox]");

  for (const c of checks) {
    await addDoc(collection(db, "asistencias"), {
      alumno: c.dataset.id,
      fecha: fecha,
      presente: c.checked
    });
  }

  alert("Asistencia guardada");
};

cargar();
</script>

</body>
</html>
